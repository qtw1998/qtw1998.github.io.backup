



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.1, mkdocs-material-3.0.3">
    
    
      
        <title>vivado - My Coding Life</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#03a9f4">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Concert+One:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Concert One","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="light-blue" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#lab3" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="My Coding Life" class="md-header-nav__button md-logo">
          
            <i class="md-icon">cloud</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                My Coding Life
              </span>
              <span class="md-header-nav__topic">
                vivado
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/qtw1998/qtw1998.github.io/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      qtw1998
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../DSandALGORITHM/Sorting/" title="DS & algorithm" class="md-tabs__link">
          DS & algorithm
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Java/web_rig_login/" title="Java" class="md-tabs__link">
          Java
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Linux/Linux基本命令行/" title="Linux" class="md-tabs__link md-tabs__link--active">
          Linux
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="My Coding Life" class="md-nav__button md-logo">
      
        <i class="md-icon">cloud</i>
      
    </a>
    My Coding Life
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/qtw1998/qtw1998.github.io/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      qtw1998
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      DS & algorithm
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        DS & algorithm
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../DSandALGORITHM/Sorting/" title="Sorting" class="md-nav__link">
      Sorting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Java
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Java
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Java/web_rig_login/" title="Web 实现登录注册功能" class="md-nav__link">
      Web 实现登录注册功能
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Linux/Linux基本命令行/" title="Linux基本命令" class="md-nav__link">
      Linux基本命令
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Linux/AWK/" title="awk" class="md-nav__link">
      awk
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MATLAB/" title="MATLAB" class="md-nav__link">
      MATLAB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Linux/OS/" title="OS" class="md-nav__link">
      OS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../LAB1.md" title="vivado" class="md-nav__link">
      vivado
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../analog/" title="analog" class="md-nav__link">
      analog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Analog Integration Design lab2 Report/" title="Analog_lab2" class="md-nav__link">
      Analog_lab2
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        vivado
      </label>
    
    <a href="./" title="vivado" class="md-nav__link md-nav__link--active">
      vivado
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#experimental-goal-requirement" title="Experimental goal &amp;requirement" class="md-nav__link">
    Experimental goal &amp;requirement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#provide-materials" title="Provide materials" class="md-nav__link">
    Provide materials
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experimental-process-and-optimization" title="Experimental process and optimization" class="md-nav__link">
    Experimental process and optimization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experimental-analysis" title="Experimental analysis" class="md-nav__link">
    Experimental analysis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experimental-summary-and-thoughts" title="Experimental summary and thoughts" class="md-nav__link">
    Experimental summary and thoughts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experiment-results" title="Experiment results" class="md-nav__link">
    Experiment results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code" title="code" class="md-nav__link">
    code
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#experimental-goal-requirement" title="Experimental goal &amp;requirement" class="md-nav__link">
    Experimental goal &amp;requirement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#provide-materials" title="Provide materials" class="md-nav__link">
    Provide materials
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experimental-process-and-optimization" title="Experimental process and optimization" class="md-nav__link">
    Experimental process and optimization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experimental-analysis" title="Experimental analysis" class="md-nav__link">
    Experimental analysis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experimental-summary-and-thoughts" title="Experimental summary and thoughts" class="md-nav__link">
    Experimental summary and thoughts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experiment-results" title="Experiment results" class="md-nav__link">
    Experiment results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code" title="code" class="md-nav__link">
    code
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/qtw1998/qtw1998.github.io/edit/master/docs/MATLAB/LAB3.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="lab3">lab3<a class="headerlink" href="#lab3" title="Permanent link">&para;</a></h1>
<hr />
<hr />
<h3 id="experimental-goal-requirement">Experimental goal &amp;requirement<a class="headerlink" href="#experimental-goal-requirement" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<ul>
<li>Learn to use interrupts.</li>
<li>Learn to use dual channel GPIO.<br/><br/>
Interrupt program design:</li>
<li>Capture interrupts from PL BTN0 and BTN1, so that when button 0 (1) is pressed, "Interrupt valid, Button 0 (1) is pressed" is output through the UART serial port.</li>
<li>After an interrupt is triggered, the second interrupt is not responded within 1 s.</li>
<li>Interrupt must be called.</li>
</ul>
<p>Dual channel GPIO design:
* Hang four switch buttons (SW0~3) and two button buttons (BTN2, BTN3) on the AXI bus using the same GPIO interface.
* On the basis of lab5, the calculation of the counting period is changed to ONE_TENTH* (4bit SW + 2bit BTN).</p>
</div>
<hr />
<h3 id="provide-materials">Provide materials<a class="headerlink" href="#provide-materials" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p>Provide materials:
Lab3 experimental material: Lab1-Lab5.pdf.</p>
</div>
<h3 id="experimental-process-and-optimization">Experimental process and optimization<a class="headerlink" href="#experimental-process-and-optimization" title="Permanent link">&para;</a></h3>
<div class="admonition success">
<p><img alt="" src="http://pdqq4cby3.bkt.clouddn.com/15435014387627.jpg" /><br/>
Figure 1 Generate a hardware system<br/>    <img alt="" src="http://pdqq4cby3.bkt.clouddn.com/15435014709704.jpg" /><br/><br/>
Figure 2 Add watchdog<br/><br/><img alt="" src="http://pdqq4cby3.bkt.clouddn.com/15435016420957.jpg" /><br/>
Figure 3 zynq settings<br/><br/><img alt="" src="http://pdqq4cby3.bkt.clouddn.com/15435016759827.jpg" /><br/>
Figure 4 The frequency of the watchdog is about 108MHz, so to make the watchdog generate an interrupt about one second after the start, you need to set the watchdog to countdown to 108000000 times.<br/><br/><img alt="" src="http://pdqq4cby3.bkt.clouddn.com/15435017154503.jpg" /><br/><br/>
Figure 5 gpio settings (interrupt button)<br/><br/><img alt="" src="http://pdqq4cby3.bkt.clouddn.com/15435017424698.jpg" /><br/><br/>
Figure 6 gpio dual channel settings (2-digit buttons and 4-digit dial switches).</p>
</div>
<h3 id="experimental-analysis">Experimental analysis<a class="headerlink" href="#experimental-analysis" title="Permanent link">&para;</a></h3>
<div class="admonition bug">
<p>Finally, the interrupt is successfully called to capture the interrupts from PL BTN0 and BTN1, so that when the button 0 (1) is pressed, the "Interrupt valid, Button 0 (1) is pressed" is output through the UART serial port, and after an interrupt trigger is implemented, within 1 s. Does not respond to the second interrupt.</p>
<p>The dual-channel GPIO design successfully changed the count period calculation to ONE_TENTH* (4bit SW + 2bit BTN), and used the same GPIO interface for the four switch buttons (SW0~3) and the two button buttons (BTN2, BTN3).</p>
<p>In summary, the experiment was successful.    </p>
</div>
<h3 id="experimental-summary-and-thoughts">Experimental summary and thoughts<a class="headerlink" href="#experimental-summary-and-thoughts" title="Permanent link">&para;</a></h3>
<div class="admonition hint">
<p>In this experiment, the main function first initializes each button, LED and interrupt, and sets the countdown of the watchdog, and then uses the while(1) loop to read the dial switch and the button value in the dual channel gpio and correspondingly Switch, etc.<br/><br/>
Each time the key value changes, the interrupt processing function BTN_handler is entered. In the handler, the valid interrupt is pressed according to the key value, and the key interrupt is turned off, and the watchdog is restarted. The watchdog will then generate an interrupt after one second, re-enabling the key interrupt in that interrupt, and a new interrupt can be generated after one second.    <br/></p>
</div>
<h3 id="experiment-results">Experiment results<a class="headerlink" href="#experiment-results" title="Permanent link">&para;</a></h3>
<div class="admonition bug">
<p>Finally, add the watchdog code. Now find the system.mss document, open the example to find an example of using the watchdog interrupt, follow the modification, and add the code to re-enable the key interrupt in the handler.
<img alt="" src="http://pdqq4cby3.bkt.clouddn.com/15435022535841.jpg" /></p>
</div>
<h3 id="code">code<a class="headerlink" href="#code" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;xparameters.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;xscugic.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;xil_exception.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;xgpio.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;xscutimer.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;xscuwdt.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;led_ip.h&quot;</span><span class="cp"></span>

<span class="c1">// Parameter definitions</span>
<span class="cp">#define WDT_DEVICE_ID       XPAR_SCUWDT_0_DEVICE_ID</span>
<span class="cp">#define INTC_DEVICE_ID      XPAR_PS7_SCUGIC_0_DEVICE_ID</span>
<span class="cp">#define LED_DEVICE_ID       XPAR_LED_IP_DEVICE_ID</span>
<span class="cp">#define BTNS_DEVICE_ID      XPAR_BUTTONS_DEVICE_ID</span>
<span class="cp">#define INT_DEVICE_ID       XPAR_GPIO_0_DEVICE_ID</span>
<span class="cp">#define INTC_GPIO_INTERRUPT_ID XPAR_FABRIC_AXI_GPIO_0_IP2INTC_IRPT_INTR</span>
<span class="cp">#define BTN_INT             XGPIO_IR_CH1_MASK </span><span class="c1">// This is the interrupt mask for channel one</span>
<span class="cp">#define DELAY 100000000</span>
<span class="cp">#define ONE_TENTH 37500000 </span><span class="c1">// half of the CPU clock speed/10</span>
<span class="cp">#define WDT_IRPT_INTR       XPAR_SCUWDT_INTR</span>

<span class="cp">#define HANDLER_CALLED      0xFFFFFFFF</span>
<span class="cp">#define WDT_LOAD_VALUE      108000000</span>
<span class="n">XGpio</span>   <span class="n">LED</span><span class="p">;</span>
<span class="n">XGpio</span>   <span class="n">BTNInst</span><span class="p">;</span>
<span class="n">XGpio</span>   <span class="n">INTBInst</span><span class="p">;</span>
<span class="n">XScuGic</span> <span class="n">INTCInst</span><span class="p">;</span>
<span class="n">XScuTimer</span> <span class="n">Timer</span><span class="p">;</span>
<span class="n">XScuTimer</span> <span class="o">*</span><span class="n">TimerInstancePtr</span><span class="p">;</span>
<span class="n">XGpio</span> <span class="n">intb</span><span class="p">;</span>
<span class="n">XScuWdt</span> <span class="n">WdtInstance</span><span class="p">;</span>        <span class="cm">/* Cortex SCU Private WatchDog Timer Instance */</span>
<span class="n">XScuGic</span> <span class="n">IntcInstance</span><span class="p">;</span>       <span class="cm">/* Interrupt Controller Instance */</span>

<span class="k">volatile</span> <span class="n">u32</span> <span class="n">HandlerCalled</span><span class="p">;</span> <span class="cm">/* flag is set when timeout interrupt occurs */</span>
<span class="c1">//----------------------------------------------------</span>
<span class="c1">// PROTOTYPE FUNCTIONS</span>
<span class="c1">//----------------------------------------------------</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">BTN_Intr_Handler</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">baseaddr_p</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">InterruptSystemSetup</span><span class="p">(</span><span class="n">XScuGic</span> <span class="o">*</span><span class="n">XScuGicInstancePtr</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">IntcInitFunction</span><span class="p">(</span><span class="n">u16</span> <span class="n">DeviceId</span><span class="p">,</span> <span class="n">XGpio</span> <span class="o">*</span><span class="n">GpioInstancePtr</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">ScuWdtIntrExample</span><span class="p">(</span><span class="n">XScuGic</span> <span class="o">*</span><span class="n">IntcInstancePtr</span><span class="p">,</span> <span class="n">XScuWdt</span> <span class="o">*</span> <span class="n">WdtInstancePtr</span><span class="p">,</span>
           <span class="n">u16</span> <span class="n">WdtDeviceId</span><span class="p">,</span> <span class="n">u16</span> <span class="n">WdtIntrId</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">WdtIntrHandler</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">CallBackRef</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">WdtSetupIntrSystem</span><span class="p">(</span><span class="n">XScuGic</span> <span class="o">*</span><span class="n">IntcInstancePtr</span><span class="p">,</span>
                  <span class="n">XScuWdt</span> <span class="o">*</span> <span class="n">WdtInstancePtr</span><span class="p">,</span> <span class="n">u16</span> <span class="n">WdtIntrId</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">WdtDisableIntrSystem</span><span class="p">(</span><span class="n">XScuGic</span> <span class="o">*</span><span class="n">IntcInstancePtr</span><span class="p">,</span> <span class="n">u16</span> <span class="n">WdtIntrId</span><span class="p">);</span>
<span class="c1">//----------------------------------------------------</span>
<span class="c1">//  INTERRUPT SERVICE ROUTINE(ISR)</span>
<span class="c1">//also know as : INTERRUPT HANDLER FUNCTION</span>
<span class="c1">// - called by the buttons interrupt, performs push buttons read</span>
<span class="c1">//----------------------------------------------------</span>

<span class="kt">void</span> <span class="nf">BTN_Intr_Handler</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">InstancePtr</span><span class="p">)</span>
<span class="p">{</span>

    <span class="kt">int</span> <span class="n">intb_check</span> <span class="o">=</span> <span class="n">XGpio_DiscreteRead</span><span class="p">(</span><span class="o">&amp;</span><span class="n">intb</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">intb_check</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">xil_printf</span><span class="p">(</span><span class="s">&quot;Interrupt valid, Button 0 is pressed</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">intb_check</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="n">xil_printf</span><span class="p">(</span><span class="s">&quot;Interrupt valid, Button 1 is pressed</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="c1">// Acknowledge GPIO interrupts</span>
    <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">XGpio_InterruptClear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">INTBInst</span><span class="p">,</span> <span class="n">BTN_INT</span><span class="p">);</span>
    <span class="c1">// Enable GPIO interrupts</span>
    <span class="n">XGpio_InterruptDisable</span><span class="p">(</span><span class="o">&amp;</span><span class="n">INTBInst</span><span class="p">,</span> <span class="n">BTN_INT</span><span class="p">);</span>
    <span class="c1">//XScuTimer_LoadTimer(TimerInstancePtr, ONE_TENTH*10);</span>
    <span class="c1">//while(!XScuTimer_IsExpired(TimerInstancePtr)){</span>
    <span class="c1">//}</span>
    <span class="n">XScuWdt_RestartWdt</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WdtInstance</span><span class="p">);</span>

<span class="p">}</span>
<span class="c1">//----------------------------------------------------</span>
<span class="c1">// MAIN FUNCTION</span>
<span class="c1">//----------------------------------------------------</span>
<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>

  <span class="n">XGpio</span> <span class="n">dip</span><span class="p">,</span> <span class="n">push</span><span class="p">;</span>
     <span class="kt">int</span> <span class="n">psb_check</span><span class="p">,</span> <span class="n">psb_check_prev</span><span class="p">,</span> <span class="n">dip_check</span><span class="p">,</span> <span class="n">dip_check_prev</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">status</span><span class="p">;</span>

     <span class="c1">// ≥ı ºªØSWITCHES,BUTTONS,∫ÕINTERRUPT</span>
     <span class="n">status</span> <span class="o">=</span> <span class="n">XGpio_Initialize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">BTNInst</span><span class="p">,</span> <span class="n">BTNS_DEVICE_ID</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">XST_SUCCESS</span><span class="p">)</span> <span class="k">return</span> <span class="n">XST_FAILURE</span><span class="p">;</span>
     <span class="n">status</span> <span class="o">=</span> <span class="n">XGpio_Initialize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">INTBInst</span><span class="p">,</span> <span class="n">INT_DEVICE_ID</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">XST_SUCCESS</span><span class="p">)</span> <span class="k">return</span> <span class="n">XST_FAILURE</span><span class="p">;</span>
     <span class="c1">//≥ı ºªØLED</span>
     <span class="n">status</span> <span class="o">=</span> <span class="n">XGpio_Initialize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">LED</span><span class="p">,</span> <span class="n">LED_DEVICE_ID</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">XST_SUCCESS</span><span class="p">)</span> <span class="k">return</span> <span class="n">XST_FAILURE</span><span class="p">;</span>
     <span class="c1">// ≥ı ºªØ÷–∂œøÿ÷∆∆˜</span>
     <span class="n">status</span> <span class="o">=</span> <span class="n">IntcInitFunction</span><span class="p">(</span><span class="n">INTC_DEVICE_ID</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">INTBInst</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">XST_SUCCESS</span><span class="p">)</span> <span class="k">return</span> <span class="n">XST_FAILURE</span><span class="p">;</span>
     <span class="c1">//≥ı ºªØwatchdog</span>
    <span class="n">XScuWdt_Config</span> <span class="o">*</span><span class="n">ConfigPtr2</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * Initialize the SCU Private Wdt driver so that it is ready to use.</span>
<span class="cm">     */</span>
    <span class="n">ConfigPtr2</span> <span class="o">=</span> <span class="n">XScuWdt_LookupConfig</span><span class="p">(</span><span class="n">WDT_DEVICE_ID</span><span class="p">);</span>

    <span class="cm">/*</span>
<span class="cm">     * This is where the virtual address would be used, this example</span>
<span class="cm">     * uses physical address.</span>
<span class="cm">     */</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">XScuWdt_CfgInitialize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WdtInstance</span><span class="p">,</span> <span class="n">ConfigPtr2</span><span class="p">,</span>
                    <span class="n">ConfigPtr2</span><span class="o">-&gt;</span><span class="n">BaseAddr</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">XST_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">XST_FAILURE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">XScuWdt_SetTimerMode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WdtInstance</span><span class="p">);</span>

        <span class="cm">/*</span>
<span class="cm">         * Load the watchdog counter register.</span>
<span class="cm">         */</span>
        <span class="n">XScuWdt_LoadWdt</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WdtInstance</span><span class="p">,</span> <span class="n">WDT_LOAD_VALUE</span><span class="p">);</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">WdtSetupIntrSystem</span><span class="p">(</span><span class="o">&amp;</span><span class="n">IntcInstance</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">WdtInstance</span><span class="p">,</span> <span class="n">WDT_IRPT_INTR</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">XST_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">XST_FAILURE</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">XScuWdt_RestartWdt</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WdtInstance</span><span class="p">);</span>
    <span class="cm">/*</span>
<span class="cm">     * Start the ScuWdt device.</span>
<span class="cm">     */</span>
    <span class="n">XScuWdt_Start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WdtInstance</span><span class="p">);</span>

     <span class="c1">// PS Timer related definitions</span>
     <span class="n">XScuTimer_Config</span> <span class="o">*</span><span class="n">ConfigPtr</span><span class="p">;</span>
     <span class="n">XScuTimer</span> <span class="o">*</span><span class="n">TimerInstancePtr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Timer</span><span class="p">;</span>


     <span class="n">xil_printf</span><span class="p">(</span><span class="s">&quot;-- Start of the Program --</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>

     <span class="n">XGpio_Initialize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">push</span><span class="p">,</span> <span class="n">XPAR_BUTTONS_DEVICE_ID</span><span class="p">);</span>
     <span class="n">XGpio_SetDataDirection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">push</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">);</span>
     <span class="n">XGpio_Initialize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">push</span><span class="p">,</span> <span class="n">XPAR_BUTTONS_DEVICE_ID</span><span class="p">);</span>
     <span class="n">XGpio_SetDataDirection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">push</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">);</span>

     <span class="n">XGpio_Initialize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">intb</span><span class="p">,</span> <span class="n">XPAR_GPIO_0_DEVICE_ID</span><span class="p">);</span>
     <span class="n">XGpio_SetDataDirection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">intb</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">);</span>

     <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

     <span class="c1">// Initialize the timer</span>
     <span class="n">ConfigPtr</span> <span class="o">=</span> <span class="n">XScuTimer_LookupConfig</span> <span class="p">(</span><span class="n">XPAR_PS7_SCUTIMER_0_DEVICE_ID</span><span class="p">);</span>
     <span class="n">status</span> <span class="o">=</span> <span class="n">XScuTimer_CfgInitialize</span>   <span class="p">(</span><span class="n">TimerInstancePtr</span><span class="p">,</span> <span class="n">ConfigPtr</span><span class="p">,</span> <span class="n">ConfigPtr</span><span class="o">-&gt;</span><span class="n">BaseAddr</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">XST_SUCCESS</span><span class="p">){</span>
      <span class="n">xil_printf</span><span class="p">(</span><span class="s">&quot;Timer init() failed</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">XST_FAILURE</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="c1">// Read dip switch values</span>
     <span class="n">dip_check_prev</span> <span class="o">=</span> <span class="n">XGpio_DiscreteRead</span><span class="p">(</span><span class="o">&amp;</span><span class="n">push</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
     <span class="n">psb_check_prev</span> <span class="o">=</span> <span class="n">XGpio_DiscreteRead</span><span class="p">(</span><span class="o">&amp;</span><span class="n">push</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
     <span class="c1">// Load timer with delay in multiple of ONE_TENTH</span>
     <span class="n">XScuTimer_LoadTimer</span><span class="p">(</span><span class="n">TimerInstancePtr</span><span class="p">,</span> <span class="n">ONE_TENTH</span><span class="o">*</span><span class="p">(</span><span class="n">dip_check_prev</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="n">psb_check_prev</span><span class="p">));</span>
     <span class="c1">// Set AutoLoad mode</span>
     <span class="n">XScuTimer_EnableAutoReload</span><span class="p">(</span><span class="n">TimerInstancePtr</span><span class="p">);</span>
     <span class="c1">// Start the timer</span>
     <span class="n">XScuTimer_Start</span> <span class="p">(</span><span class="n">TimerInstancePtr</span><span class="p">);</span>
     <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
         <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">{</span>
              <span class="c1">// Read push buttons and break the loop if Center button pressed</span>
              <span class="n">psb_check</span> <span class="o">=</span> <span class="n">XGpio_DiscreteRead</span><span class="p">(</span><span class="o">&amp;</span><span class="n">push</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
              <span class="n">dip_check</span> <span class="o">=</span> <span class="n">XGpio_DiscreteRead</span><span class="p">(</span><span class="o">&amp;</span><span class="n">push</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">((</span><span class="n">dip_check</span> <span class="o">!=</span> <span class="n">dip_check_prev</span><span class="p">)</span><span class="o">||</span><span class="p">(</span><span class="n">psb_check</span><span class="o">!=</span><span class="n">psb_check_prev</span><span class="p">))</span> <span class="p">{</span>
                  <span class="c1">//xil_printf(&quot;DIP Switch Status %x, %x\r\n&quot;, psb_check_prev, psb_check);</span>
                  <span class="n">dip_check_prev</span> <span class="o">=</span> <span class="n">dip_check</span><span class="p">;</span>
                  <span class="n">psb_check_prev</span><span class="o">=</span><span class="n">psb_check</span><span class="p">;</span>
                  <span class="c1">// load timer with the new switch settings</span>
                  <span class="n">XScuTimer_LoadTimer</span><span class="p">(</span><span class="n">TimerInstancePtr</span><span class="p">,</span> <span class="n">ONE_TENTH</span><span class="o">*</span><span class="p">(</span><span class="n">dip_check</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="n">psb_check</span><span class="p">));</span>
                  <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
              <span class="p">}</span>
              <span class="k">if</span><span class="p">(</span><span class="n">XScuTimer_IsExpired</span><span class="p">(</span><span class="n">TimerInstancePtr</span><span class="p">))</span> <span class="p">{</span>
                      <span class="c1">// clear status bit</span>
                      <span class="n">XScuTimer_ClearInterruptStatus</span><span class="p">(</span><span class="n">TimerInstancePtr</span><span class="p">);</span>
                      <span class="c1">// output the count to LED and increment the count</span>
                      <span class="n">LED_IP_mWriteReg</span><span class="p">(</span><span class="n">XPAR_LED_IP_S_AXI_BASEADDR</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
                      <span class="n">count</span><span class="o">++</span><span class="p">;</span>
              <span class="p">}</span>
            <span class="p">}</span>
     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span>
<span class="c1">//----------------------------------------------------</span>
<span class="c1">// INTERRUPT SETUP FUNCTIONS</span>
<span class="c1">//----------------------------------------------------</span>
<span class="kt">int</span> <span class="nf">IntcInitFunction</span><span class="p">(</span><span class="n">u16</span> <span class="n">DeviceId</span><span class="p">,</span> <span class="n">XGpio</span> <span class="o">*</span><span class="n">GpioInstancePtr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">XScuGic_Config</span> <span class="o">*</span><span class="n">IntcConfig</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

    <span class="c1">// Interrupt controller initialization</span>
    <span class="n">IntcConfig</span> <span class="o">=</span> <span class="n">XScuGic_LookupConfig</span><span class="p">(</span><span class="n">DeviceId</span><span class="p">);</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">XScuGic_CfgInitialize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">INTCInst</span><span class="p">,</span> <span class="n">IntcConfig</span><span class="p">,</span> <span class="n">IntcConfig</span><span class="o">-&gt;</span><span class="n">CpuBaseAddress</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">XST_SUCCESS</span><span class="p">)</span> <span class="k">return</span> <span class="n">XST_FAILURE</span><span class="p">;</span>

    <span class="c1">// Call interrupt setup function</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">InterruptSystemSetup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">INTCInst</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">XST_SUCCESS</span><span class="p">)</span> <span class="k">return</span> <span class="n">XST_FAILURE</span><span class="p">;</span>

    <span class="c1">// Register GPIO interrupt handler</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">XScuGic_Connect</span><span class="p">(</span><span class="o">&amp;</span><span class="n">INTCInst</span><span class="p">,</span>
                             <span class="n">INTC_GPIO_INTERRUPT_ID</span><span class="p">,</span>
                             <span class="p">(</span><span class="n">Xil_ExceptionHandler</span><span class="p">)</span><span class="n">BTN_Intr_Handler</span><span class="p">,</span>
                             <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">GpioInstancePtr</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">XST_SUCCESS</span><span class="p">)</span> <span class="k">return</span> <span class="n">XST_FAILURE</span><span class="p">;</span>

    <span class="c1">// Enable GPIO interrupts</span>
    <span class="n">XGpio_InterruptEnable</span><span class="p">(</span><span class="n">GpioInstancePtr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">XGpio_InterruptGlobalEnable</span><span class="p">(</span><span class="n">GpioInstancePtr</span><span class="p">);</span>

    <span class="c1">// Enable GPIO interrupts in the controller</span>
    <span class="n">XScuGic_Enable</span><span class="p">(</span><span class="o">&amp;</span><span class="n">INTCInst</span><span class="p">,</span> <span class="n">INTC_GPIO_INTERRUPT_ID</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">XST_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">InterruptSystemSetup</span><span class="p">(</span><span class="n">XScuGic</span> <span class="o">*</span><span class="n">XScuGicInstancePtr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Register GIC interrupt handler</span>

    <span class="n">Xil_ExceptionRegisterHandler</span><span class="p">(</span><span class="n">XIL_EXCEPTION_ID_INT</span><span class="p">,</span>
                                 <span class="p">(</span><span class="n">Xil_ExceptionHandler</span><span class="p">)</span><span class="n">XScuGic_InterruptHandler</span><span class="p">,</span>
                                 <span class="n">XScuGicInstancePtr</span><span class="p">);</span>
    <span class="n">Xil_ExceptionEnable</span><span class="p">();</span>


    <span class="k">return</span> <span class="n">XST_SUCCESS</span><span class="p">;</span>

<span class="p">}</span>
<span class="cm">/*****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*</span>
<span class="cm">* This function sets up the interrupt system such that interrupts can occur</span>
<span class="cm">* for the device.</span>
<span class="cm">*</span>
<span class="cm">* @param    IntcInstancePtr is a pointer to the instance of the XScuGic</span>
<span class="cm">*       driver.</span>
<span class="cm">* @param    WdtInstancePtr is a pointer to the instance of XScuWdt driver.</span>
<span class="cm">* @param    WdtIntrId is the Interrupt Id of the XScuWdt device.</span>
<span class="cm">*</span>
<span class="cm">* @return   XST_SUCCESS if successful, otherwise XST_FAILURE.</span>
<span class="cm">*</span>
<span class="cm">* @note     None.</span>
<span class="cm">*</span>
<span class="cm">******************************************************************************/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">WdtSetupIntrSystem</span><span class="p">(</span><span class="n">XScuGic</span> <span class="o">*</span><span class="n">IntcInstancePtr</span><span class="p">,</span>
                  <span class="n">XScuWdt</span> <span class="o">*</span><span class="n">WdtInstancePtr</span><span class="p">,</span> <span class="n">u16</span> <span class="n">WdtIntrId</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">Status</span><span class="p">;</span>
    <span class="n">u32</span> <span class="n">Reg</span><span class="p">;</span>

<span class="cp">#ifndef TESTAPP_GEN</span>
    <span class="n">XScuGic_Config</span> <span class="o">*</span><span class="n">IntcConfig</span><span class="p">;</span>
    <span class="cm">/*</span>
<span class="cm">     * Initialize the interrupt controller driver so that it is ready to</span>
<span class="cm">     * use.</span>
<span class="cm">     */</span>
    <span class="n">IntcConfig</span> <span class="o">=</span> <span class="n">XScuGic_LookupConfig</span><span class="p">(</span><span class="n">INTC_DEVICE_ID</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">IntcConfig</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">XST_FAILURE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">Status</span> <span class="o">=</span> <span class="n">XScuGic_CfgInitialize</span><span class="p">(</span><span class="n">IntcInstancePtr</span><span class="p">,</span> <span class="n">IntcConfig</span><span class="p">,</span>
                    <span class="n">IntcConfig</span><span class="o">-&gt;</span><span class="n">CpuBaseAddress</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Status</span> <span class="o">!=</span> <span class="n">XST_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">XST_FAILURE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">Xil_ExceptionInit</span><span class="p">();</span>

    <span class="cm">/*</span>
<span class="cm">     * Connect the interrupt controller interrupt handler to the hardware</span>
<span class="cm">     * interrupt handling logic in the processor.</span>
<span class="cm">     */</span>
    <span class="n">Xil_ExceptionRegisterHandler</span><span class="p">(</span><span class="n">XIL_EXCEPTION_ID_INT</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">Xil_ExceptionHandler</span><span class="p">)</span>
                    <span class="n">XScuGic_InterruptHandler</span><span class="p">,</span>
                    <span class="n">IntcInstancePtr</span><span class="p">);</span>
<span class="cp">#endif</span>
    <span class="cm">/*</span>
<span class="cm">     * Connect the device driver handler that will be called when an</span>
<span class="cm">     * interrupt for the device occurs, the handler defined above performs</span>
<span class="cm">     * the specific interrupt processing for the device.</span>
<span class="cm">     */</span>
    <span class="n">Status</span> <span class="o">=</span> <span class="n">XScuGic_Connect</span><span class="p">(</span><span class="n">IntcInstancePtr</span><span class="p">,</span> <span class="n">WdtIntrId</span><span class="p">,</span>
                <span class="p">(</span><span class="n">Xil_ExceptionHandler</span><span class="p">)</span><span class="n">WdtIntrHandler</span><span class="p">,</span>
                <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">WdtInstancePtr</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Status</span> <span class="o">!=</span> <span class="n">XST_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Status</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/*</span>
<span class="cm">     * Enable the watchdog interrupts for timer mode.</span>
<span class="cm">     */</span>
    <span class="n">Reg</span> <span class="o">=</span> <span class="n">XScuWdt_GetControlReg</span><span class="p">(</span><span class="n">WdtInstancePtr</span><span class="p">);</span>
    <span class="n">XScuWdt_SetControlReg</span><span class="p">(</span><span class="n">WdtInstancePtr</span><span class="p">,</span>
                <span class="n">Reg</span> <span class="o">|</span> <span class="n">XSCUWDT_CONTROL_IT_ENABLE_MASK</span><span class="p">);</span>

    <span class="cm">/*</span>
<span class="cm">     * Enable the interrupt for the device.</span>
<span class="cm">     */</span>
    <span class="n">XScuGic_Enable</span><span class="p">(</span><span class="n">IntcInstancePtr</span><span class="p">,</span> <span class="n">WdtIntrId</span><span class="p">);</span>

<span class="cp">#ifndef TESTAPP_GEN</span>
    <span class="cm">/*</span>
<span class="cm">     * Enable interrupts in the Processor.</span>
<span class="cm">     */</span>
    <span class="n">Xil_ExceptionEnable</span><span class="p">();</span>
<span class="cp">#endif</span>
    <span class="k">return</span> <span class="n">XST_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*</span>
<span class="cm">* This function is the Interrupt handler for the WDT Interrupt of the</span>
<span class="cm">* Wdt device. It is called on the expiration of the timer counter in</span>
<span class="cm">* interrupt context.</span>
<span class="cm">*</span>
<span class="cm">* @param    CallBackRef is a pointer to the callback function.</span>
<span class="cm">*</span>
<span class="cm">* @return   None.</span>
<span class="cm">*</span>
<span class="cm">* @note     None.</span>
<span class="cm">*</span>
<span class="cm">******************************************************************************/</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">WdtIntrHandler</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">CallBackRef</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     * WDT timed out and interrupt occurred, let main test loop know.</span>
<span class="cm">     */</span>
    <span class="n">XGpio_InterruptEnable</span><span class="p">(</span><span class="o">&amp;</span><span class="n">INTBInst</span><span class="p">,</span> <span class="n">BTN_INT</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*</span>
<span class="cm">* This function disables the interrupts that occur for the device.</span>
<span class="cm">*</span>
<span class="cm">* @param    IntcInstancePtr is the pointer to the instance of XScuGic</span>
<span class="cm">*       driver.</span>
<span class="cm">* @param    WdtIntrId is the Interrupt Id for the device.</span>
<span class="cm">*</span>
<span class="cm">* @return   None.</span>
<span class="cm">*</span>
<span class="cm">* @note     None.</span>
<span class="cm">*</span>
<span class="cm">******************************************************************************/</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">WdtDisableIntrSystem</span><span class="p">(</span><span class="n">XScuGic</span> <span class="o">*</span><span class="n">IntcInstancePtr</span><span class="p">,</span> <span class="n">u16</span> <span class="n">WdtIntrId</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     * Disconnect and disable the interrupt for the Wdt.</span>
<span class="cm">     */</span>
    <span class="n">XScuGic_Disconnect</span><span class="p">(</span><span class="n">IntcInstancePtr</span><span class="p">,</span> <span class="n">WdtIntrId</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Analog Integration Design lab2 Report/" title="Analog_lab2" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Analog_lab2
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://www.weibo.com/zjkqtw/home" class="md-footer-social__link fa fa-weibo"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.1",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>