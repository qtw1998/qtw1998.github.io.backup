



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.1, mkdocs-material-3.0.3">
    
    
      
        <title>Analog_lab2 - My Coding Life</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#03a9f4">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Concert+One:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Concert One","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="light-blue" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#lab2_report" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="My Coding Life" class="md-header-nav__button md-logo">
          
            <i class="md-icon">cloud</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                My Coding Life
              </span>
              <span class="md-header-nav__topic">
                Analog_lab2
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/qtw1998/qtw1998.github.io/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      qtw1998
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../DSandALGORITHM/Sorting/" title="DS & algorithm" class="md-tabs__link">
          DS & algorithm
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Java/web_rig_login/" title="Java" class="md-tabs__link">
          Java
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Linux/Linux基本命令行/" title="Linux" class="md-tabs__link md-tabs__link--active">
          Linux
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="My Coding Life" class="md-nav__button md-logo">
      
        <i class="md-icon">cloud</i>
      
    </a>
    My Coding Life
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/qtw1998/qtw1998.github.io/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      qtw1998
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      DS & algorithm
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        DS & algorithm
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../DSandALGORITHM/Sorting/" title="Sorting" class="md-nav__link">
      Sorting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Java
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Java
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Java/web_rig_login/" title="Web 实现登录注册功能" class="md-nav__link">
      Web 实现登录注册功能
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Linux/Linux基本命令行/" title="Linux基本命令" class="md-nav__link">
      Linux基本命令
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Linux/AWK/" title="awk" class="md-nav__link">
      awk
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MATLAB/" title="MATLAB" class="md-nav__link">
      MATLAB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Linux/OS/" title="OS" class="md-nav__link">
      OS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../LAB1/" title="vivado" class="md-nav__link">
      vivado
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../analog/" title="analog" class="md-nav__link">
      analog
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Analog_lab2
      </label>
    
    <a href="./" title="Analog_lab2" class="md-nav__link md-nav__link--active">
      Analog_lab2
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#name-number" title="NAME &amp; NUMBER:" class="md-nav__link">
    NAME &amp; NUMBER:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experiment-requirement" title="experiment requirement" class="md-nav__link">
    experiment requirement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-implementation-and-optimization-steps" title="the implementation and optimization steps" class="md-nav__link">
    the implementation and optimization steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-analysis" title="Resource analysis" class="md-nav__link">
    Resource analysis
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#name-number" title="NAME &amp; NUMBER:" class="md-nav__link">
    NAME &amp; NUMBER:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experiment-requirement" title="experiment requirement" class="md-nav__link">
    experiment requirement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-implementation-and-optimization-steps" title="the implementation and optimization steps" class="md-nav__link">
    the implementation and optimization steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-analysis" title="Resource analysis" class="md-nav__link">
    Resource analysis
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/qtw1998/qtw1998.github.io/edit/master/docs/MATLAB/Analog Integration Design lab2 Report.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="lab2_report">LAB2_REPORT<a class="headerlink" href="#lab2_report" title="Permanent link">&para;</a></h1>
<hr />
<h4 id="name-number">NAME &amp; NUMBER:<a class="headerlink" href="#name-number" title="Permanent link">&para;</a></h4>
<blockquote>
<p>516030910286 乔田伟</p>
</blockquote>
<hr />
<h3 id="experiment-requirement">experiment requirement<a class="headerlink" href="#experiment-requirement" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<ol>
<li>Implement a three-layer neural network to complete the recognition of handwritten numbers</li>
<li>Write the function: int dnn(...)</li>
<li>Classification accuracy is at least 90%, timing requirement is &lt;8ns, resource requirement: DSP &lt;= 100, other resources are smaller than on-chip resources (xc7z010clg400-1 8ns), throughput requirement: interval &lt;250.</li>
</ol>
</div>
<hr />
<h3 id="the-implementation-and-optimization-steps">the implementation and optimization steps<a class="headerlink" href="#the-implementation-and-optimization-steps" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<ol>
<li>First observe the code of dnn.cpp, dnn.h and dnn_test.cpp, know that dnn_test.cpp reads the weight matrix and offset matrix that have been obtained before from the file, and also reads the picture information from the test image. Dnn function. First modify the path, use dnn_test.cpp to open the file correctly. The data type used by the function in the .dnn.h file is all defined as float.</li>
<li>In dnn.cpp, first write the code for the initial calculation label according to the instructions of ppt.</li>
<li>Create a project with dnn.cpp as the top file and dnn_test.cpp as the testbench.
<img alt="" src="http://pdqq4cby3.bkt.clouddn.com/15417774711643.jpg" /></li>
<li>Perform a C-simulation and find that the correct rate is 97 percent, which proves that the code is written correctly.
<img alt="" src="http://pdqq4cby3.bkt.clouddn.com/15417775465382.jpg" /></li>
<li>Perform the synthesis and find that the interval is very large, which is 85930.
<img alt="" src="http://pdqq4cby3.bkt.clouddn.com/15417775895777.jpg" /></li>
<li>Modify dnn.h to change the floating point to ap_fixed &lt;8,3,AP_RND,AP_SAT&gt;. (This is defined by first fixing the last two parameters, modifying the first two parameters until the correct rate is higher than 90% and the number of bits used is the least).
<img alt="" src="http://pdqq4cby3.bkt.clouddn.com/15417776364499.jpg" /></li>
<li>Further synthesis, the interval was found to be 33,142.
<img alt="" src="http://pdqq4cby3.bkt.clouddn.com/15417776644314.jpg" /></li>
<li>Add the data stream as an instruction in the dnn function, because the data stream can make the loop concurrently reduce the delay; add a pipe to each outermost loop to reduce the delay of the loop; use partition expansion for w1 and w2, increase The port of the array enables multiple data to be read at the same time to facilitate the pipeline (in this case, to save resources, only two matrices of input_image and w1 are expanded); modify the matrix multiplication part in the code, and the outer layer and inner layer Interchange, this is to reduce the size of the inner loop, so that the length of the inner loop in the pipeline is shorter, reduce the delay; modify the reLu part, use a new array hidden1 to store data, because dataflow only Can modify a number of plays, this can make dataflow smooth.
<img alt="" src="http://pdqq4cby3.bkt.clouddn.com/15417777496207.jpg" /></li>
<li>After this, the synthesis was carried out and the interval was found to be 3177.
<img alt="" src="http://pdqq4cby3.bkt.clouddn.com/15417777839404.jpg" /></li>
<li>Add partition to w2. At this time, it is found that the dimension in the partition added by w1 is not modified correctly, so reset it and set the dimensions of w1 and w2 to 2.</li>
<li>Synthesize again, resulting in an incubation period of 335.</li>
<li>Add partitions to the hidden and output arrays. The time obtained is 237, which is less than 250. However, the wait and the interval are not much different, which means that the data flow does not work and the simulation result is incorrect.</li>
<li>Remove the data stream. Since the resources are sufficient, all the arrays are directly partitioned, which makes the pipeline more convenient. Modify the instruction to retain the loop of the loop in which the two matrices are multiplied, and the rest of the loop is expanded, because the other loops are relatively small, which can further increase the throughput rate.</li>
<li>The synthesis is carried out again, and the time interval is 245, which satisfies the requirements.</li>
</ol>
</div>
<hr />
<h3 id="resource-analysis">Resource analysis<a class="headerlink" href="#resource-analysis" title="Permanent link">&para;</a></h3>
<div class="admonition success">
<p>In the last solution, 74 is because the first two-layer loop is split into two, which is 32+32+10. As seen in the analysis perspective, 1 and 5 are respectively two The Initiation Interval and Iteration Latency of the outer loop, which is the extra added latency in the pipeline. Exchange the inner and outer layers of the loop, modify each loop into a perfect loop to expand the loop, try to split the score group, and add a pipeline to all loops to get the final result.</p>
<hr />
</div>
<div class="admonition hint">
<p class="admonition-title">experimental summary</p>
<p>In this lab, the project was optimized with the apfixed library, dataflow, array partition, pipeline, and unroll, and the Interval was successfully reduced to less than 250 if the resources did not exceed the on-board resources. During the experiment, dataflow was not realized but was implemented by hls as a simulation. This shows that the simulation function of hls is flawed, and the actual situation after simulation and implementation is different.</p>
</div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../analog/" title="analog" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                analog
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/qtw1998" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://www.weibo.com/zjkqtw/home" class="md-footer-social__link fa fa-weibo"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.1",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>